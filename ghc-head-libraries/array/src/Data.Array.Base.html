<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE
    BangPatterns
  , CPP
  , RankNTypes
  , MagicHash
  , UnboxedTuples
  , MultiParamTypeClasses
  , FlexibleInstances
  , FlexibleContexts
  , UnliftedFFITypes
  , RoleAnnotations
 #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# OPTIONS_HADDOCK hide #-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- Module      :  Data.Array.Base</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- Copyright   :  (c) The University of Glasgow 2001</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span><span>
</span><a name="line-20"></a><span class="hs-comment">--</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- Maintainer  :  libraries@haskell.org</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- Portability :  non-portable (MPTCs, uses Control.Monad.ST)</span><span>
</span><a name="line-24"></a><span class="hs-comment">--</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- Basis for IArray and MArray.  Not intended for external consumption;</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- use IArray or MArray instead.</span><span>
</span><a name="line-27"></a><span class="hs-comment">--</span><span>
</span><a name="line-28"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Array.Base</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.ST.Lazy</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.ST.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Lazy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ix</span><span> </span><span class="hs-special">(</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/Control.Monad.ST.Lazy.html"><span class="hs-identifier">Ix</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/Control.Monad.ST.Lazy.html"><span class="hs-identifier">range</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/Control.Monad.ST.Lazy.html"><span class="hs-identifier">index</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rangeSize</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.StablePtr</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Char.html"><span class="hs-identifier">GHC.Arr</span></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">STArray</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.Arr</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#STArray"><span class="hs-identifier hs-type">Arr</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html"><span class="hs-identifier">GHC.Arr</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ArrST</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.ST</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ST</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Base</span><span>         </span><span class="hs-special">(</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#ST"><span class="hs-identifier hs-type">IO</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">divInt#</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html"><span class="hs-identifier">GHC.Exts</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Exts.html"><span class="hs-identifier">GHC.Ptr</span></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">nullPtr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nullFunPtr</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Stable</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">StablePtr</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Stable.html"><span class="hs-identifier">GHC.Int</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Stable.html#StablePtr"><span class="hs-identifier hs-type">Int8</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">Int16</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">Int32</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier">Int64</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Word</span><span>         </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Word8</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Word16</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Word32</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Word64</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Word.html"><span class="hs-identifier">GHC.IO</span></a><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">stToIO</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.IOArray</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">IOArray</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>                          </span><span class="hs-identifier">newIOArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unsafeReadIOArray</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unsafeWriteIOArray</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-cpp">#include &quot;MachDeps.h&quot;
</span><span>
</span><a name="line-55"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- Class of immutable arrays</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">{- | Class of immutable array types.

An array type has the form @(a i e)@ where @a@ is the array type
constructor (kind @* -&gt; * -&gt; *@), @i@ is the index type (a member of
the class 'Ix'), and @e@ is the element type.  The @IArray@ class is
parameterised over both @a@ and @e@, so that instances specialised to
certain element types can be defined.
-}</span><span>
</span><a name="line-66"></a><span class="hs-keyword">class</span><span> </span><a name="IArray"><a href="Data.Array.Base.html#IArray"><span class="hs-identifier">IArray</span></a></a><span> </span><a name="local-6989586621679028808"><a href="#local-6989586621679028808"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679028809"><a href="#local-6989586621679028809"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-comment">-- | Extracts the bounds of an immutable array</span><span>
</span><a name="line-68"></a><span>    </span><a name="bounds"><a href="Data.Array.Base.html#bounds"><span class="hs-identifier">bounds</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028810"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028810"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028810"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679028810"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>    </span><a name="numElements"><a href="Data.Array.Base.html#numElements"><span class="hs-identifier">numElements</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028811"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028811"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-70"></a><span>    </span><a name="unsafeArray"><a href="Data.Array.Base.html#unsafeArray"><span class="hs-identifier">unsafeArray</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028812"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028812"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679028812"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028812"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-71"></a><span>    </span><a name="unsafeAt"><a href="Data.Array.Base.html#unsafeAt"><span class="hs-identifier">unsafeAt</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028813"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028813"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-72"></a><span>    </span><a name="unsafeReplace"><a href="Data.Array.Base.html#unsafeReplace"><span class="hs-identifier">unsafeReplace</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028814"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028814"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028814"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-73"></a><span>    </span><a name="unsafeAccum"><a href="Data.Array.Base.html#unsafeAccum"><span class="hs-identifier">unsafeAccum</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028815"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028816"><span class="hs-identifier hs-type">e'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028815"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679028816"><span class="hs-identifier hs-type">e'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028815"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-74"></a><span>    </span><a name="unsafeAccumArray"><a href="Data.Array.Base.html#unsafeAccumArray"><span class="hs-identifier">unsafeAccumArray</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679028817"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028818"><span class="hs-identifier hs-type">e'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028817"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679028817"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679028818"><span class="hs-identifier hs-type">e'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679028808"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679028817"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679028809"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>    </span><a name="local-8214565720323797667"><a href="Data.Array.Base.html#unsafeReplace"><span class="hs-identifier">unsafeReplace</span></a></a><span> </span><a name="local-6989586621679028819"><a href="#local-6989586621679028819"><span class="hs-identifier">arr</span></a></a><span> </span><a name="local-6989586621679028820"><a href="#local-6989586621679028820"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#runST"><span class="hs-identifier hs-var">runST</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#unsafeReplaceST"><span class="hs-identifier hs-var">unsafeReplaceST</span></a><span> </span><a href="#local-6989586621679028819"><span class="hs-identifier hs-var">arr</span></a><span> </span><a href="#local-6989586621679028820"><span class="hs-identifier hs-var">ies</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="Data.Array.Base.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>    </span><a name="local-8214565720323797668"><a href="Data.Array.Base.html#unsafeAccum"><span class="hs-identifier">unsafeAccum</span></a></a><span> </span><a name="local-6989586621679028821"><a href="#local-6989586621679028821"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028822"><a href="#local-6989586621679028822"><span class="hs-identifier">arr</span></a></a><span> </span><a name="local-6989586621679028823"><a href="#local-6989586621679028823"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#runST"><span class="hs-identifier hs-var">runST</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#unsafeAccumST"><span class="hs-identifier hs-var">unsafeAccumST</span></a><span> </span><a href="#local-6989586621679028821"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679028822"><span class="hs-identifier hs-var">arr</span></a><span> </span><a href="#local-6989586621679028823"><span class="hs-identifier hs-var">ies</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="Data.Array.Base.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><a name="local-8214565720323797669"><a href="Data.Array.Base.html#unsafeAccumArray"><span class="hs-identifier">unsafeAccumArray</span></a></a><span> </span><a name="local-6989586621679028824"><a href="#local-6989586621679028824"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679028825"><a href="#local-6989586621679028825"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679028826"><a href="#local-6989586621679028826"><span class="hs-identifier">lu</span></a></a><span> </span><a name="local-6989586621679028827"><a href="#local-6989586621679028827"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#runST"><span class="hs-identifier hs-var">runST</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#unsafeAccumArrayST"><span class="hs-identifier hs-var">unsafeAccumArrayST</span></a><span> </span><a href="#local-6989586621679028824"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679028825"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679028826"><span class="hs-identifier hs-var">lu</span></a><span> </span><a href="#local-6989586621679028827"><span class="hs-identifier hs-var">ies</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a><span> </span><a href="Data.Array.Base.html#unsafeFreeze"><span class="hs-identifier hs-var">unsafeFreeze</span></a><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">safeRangeSize</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-81"></a><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029719"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029719"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029719"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-82"></a><a name="safeRangeSize"><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier">safeRangeSize</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029720"><a href="#local-6989586621679029720"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029721"><a href="#local-6989586621679029721"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029722"><a href="#local-6989586621679029722"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#rangeSize"><span class="hs-identifier hs-var">rangeSize</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029720"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029721"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679029722"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-string">&quot;Negative range size&quot;</span><span>
</span><a name="line-84"></a><span>                                  </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679029722"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">safeIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-87"></a><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029718"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029718"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029718"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029718"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-88"></a><a name="safeIndex"><a href="Data.Array.Base.html#safeIndex"><span class="hs-identifier">safeIndex</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029737"><a href="#local-6989586621679029737"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029738"><a href="#local-6989586621679029738"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029739"><a href="#local-6989586621679029739"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679029740"><a href="#local-6989586621679029740"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029741"><a href="#local-6989586621679029741"><span class="hs-identifier">i'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#index"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029737"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029738"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029740"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-89"></a><span>                      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679029741"><span class="hs-identifier hs-var">i'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029741"><span class="hs-identifier hs-var">i'</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679029739"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>                         </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679029741"><span class="hs-identifier hs-var">i'</span></a><span>
</span><a name="line-91"></a><span>                         </span><span class="hs-keyword">else</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Error in array index; &quot;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679029741"><span class="hs-identifier hs-var">i'</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span>
</span><a name="line-92"></a><span>                                     </span><span class="hs-string">&quot; not in range [0..&quot;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a><span> </span><a href="#local-6989586621679029739"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a><span> </span><span class="hs-string">&quot;)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplaceST</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-95"></a><span class="hs-identifier">unsafeReplaceST</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">IArray</span></a><span> </span><a href="#local-6989586621679029714"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029715"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029716"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679029714"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029716"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029715"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029715"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#ST"><span class="hs-identifier hs-type">ST</span></a><span> </span><a href="#local-6989586621679029717"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#STArray"><span class="hs-identifier hs-type">STArray</span></a><span> </span><a href="#local-6989586621679029717"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679029716"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029715"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-96"></a><a name="unsafeReplaceST"><a href="Data.Array.Base.html#unsafeReplaceST"><span class="hs-identifier">unsafeReplaceST</span></a></a><span> </span><a name="local-6989586621679029742"><a href="#local-6989586621679029742"><span class="hs-identifier">arr</span></a></a><span> </span><a name="local-6989586621679029743"><a href="#local-6989586621679029743"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-97"></a><span>    </span><a name="local-6989586621679029744"><a href="#local-6989586621679029744"><span class="hs-identifier">marr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#thaw"><span class="hs-identifier hs-var">thaw</span></a><span> </span><a href="#local-6989586621679029742"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-98"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a><span> </span><span class="hs-special">[</span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">unsafeWrite</span></a><span> </span><a href="#local-6989586621679029744"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029745"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679029746"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679029745"><a href="#local-6989586621679029745"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679029746"><a href="#local-6989586621679029746"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679029743"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-99"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679029744"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumST</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-102"></a><span class="hs-identifier">unsafeAccumST</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">IArray</span></a><span> </span><a href="#local-6989586621679029709"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029710"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029711"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029710"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029712"><span class="hs-identifier hs-type">e'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029710"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029709"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029711"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029710"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029712"><span class="hs-identifier hs-type">e'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#ST"><span class="hs-identifier hs-type">ST</span></a><span> </span><a href="#local-6989586621679029713"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#STArray"><span class="hs-identifier hs-type">STArray</span></a><span> </span><a href="#local-6989586621679029713"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679029711"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029710"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><a name="unsafeAccumST"><a href="Data.Array.Base.html#unsafeAccumST"><span class="hs-identifier">unsafeAccumST</span></a></a><span> </span><a name="local-6989586621679029747"><a href="#local-6989586621679029747"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029748"><a href="#local-6989586621679029748"><span class="hs-identifier">arr</span></a></a><span> </span><a name="local-6989586621679029749"><a href="#local-6989586621679029749"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621679029750"><a href="#local-6989586621679029750"><span class="hs-identifier">marr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#thaw"><span class="hs-identifier hs-var">thaw</span></a><span> </span><a href="#local-6989586621679029748"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-105"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679029753"><a href="#local-6989586621679029753"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">unsafeRead</span></a><span> </span><a href="#local-6989586621679029750"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029751"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-106"></a><span>                  </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">unsafeWrite</span></a><span> </span><a href="#local-6989586621679029750"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029751"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029747"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679029753"><span class="hs-identifier hs-var">old</span></a><span> </span><a href="#local-6989586621679029752"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679029751"><a href="#local-6989586621679029751"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679029752"><a href="#local-6989586621679029752"><span class="hs-identifier">new</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679029749"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-108"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679029750"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArrayST</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-111"></a><span class="hs-identifier">unsafeAccumArrayST</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029705"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029706"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029707"><span class="hs-identifier hs-type">e'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029706"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029706"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029705"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679029705"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029707"><span class="hs-identifier hs-type">e'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#ST"><span class="hs-identifier hs-type">ST</span></a><span> </span><a href="#local-6989586621679029708"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#STArray"><span class="hs-identifier hs-type">STArray</span></a><span> </span><a href="#local-6989586621679029708"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679029705"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029706"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><a name="unsafeAccumArrayST"><a href="Data.Array.Base.html#unsafeAccumArrayST"><span class="hs-identifier">unsafeAccumArrayST</span></a></a><span> </span><a name="local-6989586621679029754"><a href="#local-6989586621679029754"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679029755"><a href="#local-6989586621679029755"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029756"><a href="#local-6989586621679029756"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029757"><a href="#local-6989586621679029757"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029758"><a href="#local-6989586621679029758"><span class="hs-identifier">ies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-113"></a><span>    </span><a name="local-6989586621679029759"><a href="#local-6989586621679029759"><span class="hs-identifier">marr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">newArray</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029756"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029757"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029755"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-114"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679029762"><a href="#local-6989586621679029762"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">unsafeRead</span></a><span> </span><a href="#local-6989586621679029759"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029760"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-115"></a><span>                  </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">unsafeWrite</span></a><span> </span><a href="#local-6989586621679029759"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029760"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029754"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679029762"><span class="hs-identifier hs-var">old</span></a><span> </span><a href="#local-6989586621679029761"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679029760"><a href="#local-6989586621679029760"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679029761"><a href="#local-6989586621679029761"><span class="hs-identifier">new</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679029758"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-117"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679029759"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">array</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">{-| Constructs an immutable array from a pair of bounds and a list of
initial associations.

The bounds are specified as a pair of the lowest and highest bounds in
the array respectively.  For example, a one-origin vector of length 10
has bounds (1,10), and a one-origin 10 by 10 matrix has bounds
((1,1),(10,10)).

An association is a pair of the form @(i,x)@, which defines the value of
the array at index @i@ to be @x@.  The array is undefined if any index
in the list is out of bounds.  If any two associations in the list have
the same index, the value at that index is implementation-dependent.
(In GHC, the last value specified for that index is used.
Other implementations will also do this for unboxed arrays, but Haskell
98 requires that for 'Array' the value at such indices is bottom.)

Because the indices must be checked for these errors, 'array' is
strict in the bounds argument and in the indices of the association
list.  Whether @array@ is strict or non-strict in the elements depends
on the array type: 'Data.Array.Array' is a non-strict array type, but
all of the 'Data.Array.Unboxed.UArray' arrays are strict.  Thus in a
non-strict array, recurrences such as the following are possible:

&gt; a = array (1,100) ((1,1) : [(i, i * a!(i-1)) | i \&lt;- [2..100]])

Not every index within the bounds of the array need appear in the
association list, but the values associated with indices that do not
appear will be undefined.

If, in any dimension, the lower bound is greater than the upper bound,
then the array is legal, but empty. Indexing an empty array always
gives an array-bounds error, but 'bounds' still yields the bounds with
which the array was constructed.
-}</span><span>
</span><a name="line-156"></a><span class="hs-identifier">array</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">IArray</span></a><span> </span><a href="#local-6989586621679029702"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029703"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029704"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029704"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679029704"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- ^ bounds of the array: (lowest,highest)</span><span>
</span><a name="line-158"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679029704"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029703"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ list of associations</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029702"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029704"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029703"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-160"></a><a name="array"><a href="Data.Array.Base.html#array"><span class="hs-identifier">array</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029763"><a href="#local-6989586621679029763"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029764"><a href="#local-6989586621679029764"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029765"><a href="#local-6989586621679029765"><span class="hs-identifier">ies</span></a></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029766"><a href="#local-6989586621679029766"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">safeRangeSize</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029763"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029764"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="Data.Array.Base.html#unsafeArray"><span class="hs-identifier hs-var">unsafeArray</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029763"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029764"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>                     </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Data.Array.Base.html#safeIndex"><span class="hs-identifier hs-var">safeIndex</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029763"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029764"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029766"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679029767"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679029768"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679029767"><a href="#local-6989586621679029767"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679029768"><a href="#local-6989586621679029768"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679029765"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- Since unsafeFreeze is not guaranteed to be only a cast, we will</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- use unsafeArray and zip instead of a specialized loop to implement</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- listArray, unlike Array.listArray, even though it generates some</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- unnecessary heap allocation. Will use the loop only when we have</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- fast unsafeFreeze, namely for Array and UArray (well, they cover</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- almost all cases).</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">listArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Constructs an immutable array from a list of initial elements.</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- The list gives the elements of the array in ascending order</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- beginning with the lowest index.</span><span>
</span><a name="line-177"></a><span class="hs-identifier">listArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">IArray</span></a><span> </span><a href="#local-6989586621679029699"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029700"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029701"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029701"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679029701"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679029700"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679029699"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679029701"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029700"><span class="hs-identifier hs-type">e</span></a><span>
</span><a name="line-178"></a><a name="listArray"><a href="Data.Array.Base.html#listArray"><span class="hs-identifier">listArray</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029769"><a href="#local-6989586621679029769"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029770"><a href="#local-6989586621679029770"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029771"><a href="#local-6989586621679029771"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-179"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029772"><a href="#local-6989586621679029772"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">safeRangeSize</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029769"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029770"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-keyword">in</span><span> </span><a href="Data.Array.Base.html#unsafeArray"><span class="hs-identifier hs-var">unsafeArray</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029769"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029770"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><a href="#local-6989586621679029772"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679029771"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">listArrayST</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-183"></a><span class="hs-identifier">listArrayST</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029696"><span class="hs-identifier hs-type">i</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029696"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="#local-6989586621679029696"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679029697"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#ST"><span class="hs-identifier hs-type">ST</span></a><span> </span><a href="#local-6989586621679029698"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#STArray"><span class="hs-identifier hs-type">STArray</span></a><span> </span><a href="#local-6989586621679029698"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679029696"><span class="hs-identifier hs-type">i</span></a><span> </span><a href="#local-6989586621679029697"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><a name="listArrayST"><a href="Data.Array.Base.html#listArrayST"><span class="hs-identifier">listArrayST</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679029964"><a href="#local-6989586621679029964"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679029965"><a href="#local-6989586621679029965"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679029966"><a href="#local-6989586621679029966"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-185"></a><span>    </span><a name="local-6989586621679029967"><a href="#local-6989586621679029967"><span class="hs-identifier">marr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#newArray_"><span class="hs-identifier hs-var">newArray_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029964"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029965"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029968"><a href="#local-6989586621679029968"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">safeRangeSize</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029964"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029965"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679029969"><a href="#local-6989586621679029969"><span class="hs-identifier">fillFromList</span></a></a><span> </span><a name="local-6989586621679029970"><a href="#local-6989586621679029970"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679029971"><a href="#local-6989586621679029971"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679029970"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679029968"><span class="hs-identifier hs-var">n</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679029971"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-189"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>            </span><a name="local-6989586621679029972"><a href="#local-6989586621679029972"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679029973"><a href="#local-6989586621679029973"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">unsafeWrite</span></a><span> </span><a href="#local-6989586621679029967"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679029970"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679029972"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><a href="#local-6989586621679029969"><span class="hs-identifier hs-var">fillFromList</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029970"><span class="hs-identifier hs-var">i</span></a><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029973"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-191"></a><span>    </span><a href="#local-6989586621679029969"><span class="hs-identifier hs-var">fillFromList</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679029966"><span class="hs-identifier hs-var">es</span></a><span>
</span><a name="line-192"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679029967"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-195"></a><span class="hs-pragma">&quot;listArray/Array&quot;</span><span> </span><span class="hs-pragma">listArray</span><span> </span><span class="hs-pragma">=</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">ArrST.unsafeFreezeSTArray</span><span class="hs-pragma">)</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-200"></a><span class="hs-identifier">listUArrayST</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span class="hs-identifier">listUArrayST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">es</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-203"></a><span>    </span><a name="listUArrayST"><a href="Data.Array.Base.html#listUArrayST"><span class="hs-identifier">marr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fillFromList</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">n</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-207"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>            </span><span class="hs-identifier hs-var">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-operator">&gt;&gt;</span><span> </span><span class="hs-identifier">fillFromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier">fillFromList</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">es</span><span>
</span><a name="line-210"></a><span>    </span><a href="#local-6989586621679029979"><span class="hs-identifier hs-var">return</span></a><span> </span><a href="#local-6989586621679029979"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- I don't know how to write a single rule for listUArrayST, because</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- the type looks like constrained over 's', which runST doesn't</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- like. In fact all MArray (STUArray s) instances are polymorphic</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- wrt. 's', but runST can't know that.</span><span>
</span><a name="line-216"></a><span class="hs-comment">--</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- More precisely, we'd like to write this:</span><span>
</span><a name="line-218"></a><span class="hs-comment">--   listUArray :: (forall s. MArray (STUArray s) e (ST s), Ix i)</span><span>
</span><a name="line-219"></a><span class="hs-comment">--              =&gt; (i,i) -&gt; [e] -&gt; UArray i e</span><span>
</span><a name="line-220"></a><span class="hs-comment">--   listUArray lu = runST (listUArrayST lu es &gt;&gt;= unsafeFreezeSTUArray)</span><span>
</span><a name="line-221"></a><span class="hs-comment">--   {-# RULES listArray = listUArray</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- Then we could call listUArray at any type 'e' that had a suitable</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- MArray instance.  But sadly we can't, because we don't have quantified</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- constraints.  Hence the mass of rules below.</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-comment">-- I would like also to write a rule for listUArrayST (or listArray or</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- whatever) applied to unpackCString#. Unfortunately unpackCString#</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- calls seem to be floated out, then floated back into the middle</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- of listUArrayST, so I was not able to do this.</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ListUArray</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">e</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-234"></a><span class="hs-pragma">&quot;listArray/UArray/Bool&quot;</span><span>      </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-235"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Bool</span><span>
</span><a name="line-236"></a><span class="hs-pragma">&quot;listArray/UArray/Char&quot;</span><span>      </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-237"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Char</span><span>
</span><a name="line-238"></a><span class="hs-pragma">&quot;listArray/UArray/Int&quot;</span><span>       </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-239"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Int</span><span>
</span><a name="line-240"></a><span class="hs-pragma">&quot;listArray/UArray/Word&quot;</span><span>      </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-241"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Word</span><span>
</span><a name="line-242"></a><span class="hs-pragma">&quot;listArray/UArray/Ptr&quot;</span><span>       </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-243"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Ptr</span><span> </span><span class="hs-pragma">a</span><span class="hs-pragma">)</span><span>
</span><a name="line-244"></a><span class="hs-pragma">&quot;listArray/UArray/FunPtr&quot;</span><span>    </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-245"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">FunPtr</span><span> </span><span class="hs-pragma">a</span><span class="hs-pragma">)</span><span>
</span><a name="line-246"></a><span class="hs-pragma">&quot;listArray/UArray/Float&quot;</span><span>     </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-247"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Float</span><span>
</span><a name="line-248"></a><span class="hs-pragma">&quot;listArray/UArray/Double&quot;</span><span>    </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-249"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Double</span><span>
</span><a name="line-250"></a><span class="hs-pragma">&quot;listArray/UArray/StablePtr&quot;</span><span> </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-251"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">StablePtr</span><span> </span><span class="hs-pragma">a</span><span class="hs-pragma">)</span><span>
</span><a name="line-252"></a><span class="hs-pragma">&quot;listArray/UArray/Int8&quot;</span><span>      </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-253"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Int8</span><span>
</span><a name="line-254"></a><span class="hs-pragma">&quot;listArray/UArray/Int16&quot;</span><span>     </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-255"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Int16</span><span>
</span><a name="line-256"></a><span class="hs-pragma">&quot;listArray/UArray/Int32&quot;</span><span>     </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-257"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Int32</span><span>
</span><a name="line-258"></a><span class="hs-pragma">&quot;listArray/UArray/Int64&quot;</span><span>     </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-259"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Int64</span><span>
</span><a name="line-260"></a><span class="hs-pragma">&quot;listArray/UArray/Word8&quot;</span><span>     </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-261"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Word8</span><span>
</span><a name="line-262"></a><span class="hs-pragma">&quot;listArray/UArray/Word16&quot;</span><span>    </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-263"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Word16</span><span>
</span><a name="line-264"></a><span class="hs-pragma">&quot;listArray/UArray/Word32&quot;</span><span>    </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-265"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Word32</span><span>
</span><a name="line-266"></a><span class="hs-pragma">&quot;listArray/UArray/Word64&quot;</span><span>    </span><span class="hs-pragma">listArray</span><span>
</span><a name="line-267"></a><span>   </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">\</span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">runST</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">listUArrayST</span><span> </span><span class="hs-pragma">lu</span><span> </span><span class="hs-pragma">es</span><span> </span><span class="hs-pragma">&gt;&gt;=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">ListUArray</span><span> </span><span class="hs-pragma">Word64</span><span>
</span><a name="line-268"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">!</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- | Returns the element of an immutable array at the specified index.</span><span>
</span><a name="line-272"></a><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-273"></a><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-274"></a><span>              </span><span class="hs-special">(</span><a href="#local-6989586621679029690"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029691"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">numElements</span><span> </span><span class="hs-identifier">arr</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">indices</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- | Returns a list of all the valid indices in an array.</span><span>
</span><a name="line-278"></a><span class="hs-identifier">indices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">i</span><span class="hs-special">]</span><span>
</span><a name="line-279"></a><span class="hs-identifier">indices</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">range</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">elems</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- | Returns a list of all the elements of an array, in the same order</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- as their indices.</span><span>
</span><a name="line-284"></a><span class="hs-identifier">elems</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">e</span><span class="hs-special">]</span><span>
</span><a name="line-285"></a><span class="hs-identifier">elems</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">assocs</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- | Returns the contents of an array as a list of associations.</span><span>
</span><a name="line-289"></a><span class="hs-identifier">assocs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-290"></a><span class="hs-identifier">assocs</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">!</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">range</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><a href="#local-6989586621679029683"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">accumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-comment">{-|
Constructs an immutable array from a list of associations.  Unlike
'array', the same index is allowed to occur multiple times in the list
of associations; an /accumulating function/ is used to combine the
values of elements with the same index.

For example, given a list of values of some index type, hist produces
a histogram of the number of occurrences of each index within a
specified range:

&gt; hist :: (Ix a, Num b) =&gt; (a,a) -&gt; [a] -&gt; Array a b
&gt; hist bnds is = accumArray (+) 0 bnds [(i, 1) | i\&lt;-is, inRange bnds i]
-}</span><span>
</span><a name="line-308"></a><span class="hs-identifier">accumArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ An accumulating function</span><span>
</span><a name="line-310"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span>                  </span><span class="hs-comment">-- ^ A default element</span><span>
</span><a name="line-311"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029678"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ The bounds of the array</span><span>
</span><a name="line-312"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">)</span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ List of associations</span><span>
</span><a name="line-313"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>              </span><span class="hs-comment">-- ^ Returns: the array</span><span>
</span><a name="line-314"></a><span class="hs-identifier">accumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><a name="local-6989586621679029998"><a href="#local-6989586621679029998"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>                        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">]</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">//</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-320"></a><span class="hs-comment">{-|
Takes an array and a list of pairs and returns an array identical to
the left argument except that it has been updated by the associations
in the right argument.  For example, if m is a 1-origin, n by n matrix,
then @m\/\/[((i,i), 0) | i \&lt;- [1..n]]@ is the same matrix, except with
the diagonal zeroed.

As with the 'array' function, if any two associations in the list have
the same index, the value at that index is implementation-dependent.
(In GHC, the last value specified for that index is used.
Other implementations will also do this for unboxed arrays, but Haskell
98 requires that for 'Array' the value at such indices is bottom.)

For most array types, this operation is O(/n/) where /n/ is the size
of the array.  However, the diffarray package provides an array type
for which this operation has complexity linear in the number of updates.
-}</span><span>
</span><a name="line-337"></a><span class="hs-special">(</span><span class="hs-operator">//</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-338"></a><span class="hs-identifier">arr</span><span> </span><span class="hs-operator">//</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-339"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">numElements</span><span> </span><span class="hs-identifier">arr</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">]</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">accum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-343"></a><span class="hs-comment">{-|
@accum f@ takes an array and an association list and accumulates pairs
from the list into the array with the accumulating function @f@. Thus
'accumArray' can be defined using 'accum':

&gt; accumArray f z b = accum f (array b [(i, z) | i \&lt;- range b])
-}</span><span>
</span><a name="line-350"></a><span class="hs-identifier">accum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-351"></a><span class="hs-identifier">accum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-352"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a href="#local-6989586621679029670"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-353"></a><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">unsafeAccum</span><span> </span><a href="Data.Array.Base.html#bounds"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679030012"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">]</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">amap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- | Returns a new array derived from the original array by applying a</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- function to each of the elements.</span><span>
</span><a name="line-358"></a><span class="hs-identifier">amap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-359"></a><span class="hs-identifier">amap</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-360"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-361"></a><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">ixmap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- | Returns a new array derived from the original array by applying a</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- function to each of the indices.</span><span>
</span><a name="line-367"></a><span class="hs-identifier">ixmap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">j</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">j</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">j</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-368"></a><span class="hs-identifier">ixmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-369"></a><span>    </span><span class="hs-identifier">array</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-identifier">f</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">range</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- Normal polymorphic arrays</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">Arr.Array</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-376"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Arr.bounds</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-identifier">numElements</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Arr.numElements</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-380"></a><span>    </span><a name="local-8214565720323797664"><a href="Data.Array.Base.html#numElements"><span class="hs-identifier">unsafeArray</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#numElements"><span class="hs-identifier hs-var">Arr.unsafeArray</span></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-382"></a><span>    </span><a name="local-8214565720323797665"><a href="Data.Array.Base.html#unsafeArray"><span class="hs-identifier">unsafeAt</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeArray"><span class="hs-identifier hs-var">Arr.unsafeAt</span></a><span>
</span><a name="line-383"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-384"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Arr.unsafeReplace</span><span>
</span><a name="line-385"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-386"></a><span>    </span><a name="local-8214565720323797667"><a href="Data.Array.Base.html#unsafeReplace"><span class="hs-identifier">unsafeAccum</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeReplace"><span class="hs-identifier hs-var">Arr.unsafeAccum</span></a><span>
</span><a name="line-387"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-388"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Arr.unsafeAccumArray</span><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- Flat unboxed arrays</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- | Arrays with unboxed elements.  Instances of 'IArray' are provided</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- for 'UArray' with certain element types ('Int', 'Float', 'Char',</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- etc.; see the 'UArray' class for a full list).</span><span>
</span><a name="line-396"></a><span class="hs-comment">--</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- A 'UArray' will generally be more efficient (in terms of both time</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- and space) than the equivalent 'Data.Array.Array' with the same</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- element type.  However, 'UArray' is strict in its elements - so</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- don\'t use 'UArray' if you require the non-strictness that</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- 'Data.Array.Array' provides.</span><span>
</span><a name="line-402"></a><span class="hs-comment">--</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- Because the @IArray@ interface provides operations overloaded on</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- the type of the array, it should be possible to just change the</span><span>
</span><a name="line-405"></a><span class="hs-comment">-- array type being used by a program from say @Array@ to @UArray@ to</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- get the benefits of unboxed arrays (don\'t forget to import</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- &quot;Data.Array.Unboxed&quot; instead of &quot;Data.Array&quot;).</span><span>
</span><a name="line-408"></a><span class="hs-comment">--</span><span>
</span><a name="line-409"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">Int</span><span> </span><span class="hs-identifier">ByteArray#</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- There are class-based invariants on both parameters. See also #9220.</span><span>
</span><a name="line-411"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">nominal</span><span> </span><span class="hs-identifier">nominal</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArrayUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-414"></a><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">ies</span></a><span> </span><span class="hs-identifier">default_elem</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-417"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029661"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="#local-6989586621679029661"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">default_elem</span><span>
</span><a name="line-418"></a><span>    </span><a name="unsafeArrayUArray"><a href="Data.Array.Base.html#unsafeArrayUArray"><span class="hs-identifier">sequence_</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><a name="local-6989586621679030033"><a href="#local-6989586621679030033"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679030033"><a href="#local-6989586621679030033"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679030033"><a href="#local-6989586621679030033"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">]</span><span>
</span><a name="line-419"></a><span>    </span><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-422"></a><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-424"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unsafeFreezeByteArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-type">s2#</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-special">(#</span><span> </span><a name="unsafeFreezeSTUArray"><a href="Data.Array.Base.html#unsafeFreezeSTUArray"><span class="hs-identifier">s2#</span></a></a><span class="hs-special">,</span><span> </span><a name="unsafeFreezeSTUArray"><a href="Data.Array.Base.html#unsafeFreezeSTUArray"><span class="hs-identifier">UArray</span></a></a><span> </span><a name="unsafeFreezeSTUArray"><a href="Data.Array.Base.html#unsafeFreezeSTUArray"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-identifier">u</span><span> </span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-var">arr#</span></a><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplaceUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-428"></a><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">ies</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">thawSTUArray</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-type">arr</span></a><span>
</span><a name="line-432"></a><span>    </span><a name="unsafeReplaceUArray"><a href="Data.Array.Base.html#unsafeReplaceUArray"><span class="hs-identifier">sequence_</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">]</span><span>
</span><a name="line-433"></a><span>    </span><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-434"></a><span>
</span><a name="line-435"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-436"></a><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">ies</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-439"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">thawSTUArray</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-440"></a><span>    </span><a name="unsafeAccumUArray"><a href="Data.Array.Base.html#unsafeAccumUArray"><span class="hs-identifier">sequence_</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">old</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span>
</span><a name="line-441"></a><span>                  </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">old</span><span> </span><span class="hs-identifier">new</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">new</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-443"></a><span>    </span><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArrayUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-446"></a><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e'</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-449"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">initialValue</span><span>
</span><a name="line-450"></a><span>    </span><a name="unsafeAccumArrayUArray"><a href="Data.Array.Base.html#unsafeAccumArrayUArray"><span class="hs-identifier">sequence_</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><a name="unsafeAccumArrayUArray"><a href="Data.Array.Base.html#unsafeAccumArrayUArray"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a name="local-6989586621679030057"><a href="#local-6989586621679030057"><span class="hs-identifier">unsafeRead</span></a></a><span> </span><span class="hs-identifier">marr</span><span> </span><a name="local-6989586621679030059"><a href="#local-6989586621679030059"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-451"></a><span>                  </span><span class="hs-identifier">unsafeWrite</span><span> </span><a href="#local-6989586621679030057"><span class="hs-identifier hs-var">marr</span></a><span> </span><a href="#local-6989586621679030057"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679030057"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier">old</span><span> </span><span class="hs-identifier">new</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">new</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">ies</span></a><span class="hs-special">]</span><span>
</span><a name="line-453"></a><span>    </span><span class="hs-identifier">unsafeFreezeSTUArray</span><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">marr</span></a><span>
</span><a name="line-454"></a><span>
</span><a name="line-455"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">eqUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-456"></a><span class="hs-identifier">eqUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-457"></a><span class="hs-identifier">eqUArray</span><span> </span><span class="hs-identifier">arr1</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l1</span><span> </span><span class="hs-identifier">u1</span><span> </span><span class="hs-identifier">n1</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arr2</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l2</span><span> </span><span class="hs-identifier">u2</span><span> </span><span class="hs-identifier">n2</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-458"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">n1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-type">n2</span></a><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-operator hs-type">==</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-459"></a><span>    </span><a name="eqUArray"><a href="Data.Array.Base.html#eqUArray"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-operator">==</span><span> </span><a name="local-6989586621679030065"><a href="#local-6989586621679030065"><span class="hs-identifier">l2</span></a></a><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-var">u1</span></a><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-operator hs-var">==</span></a><span> </span><a name="local-6989586621679030066"><a href="#local-6989586621679030066"><span class="hs-identifier">u2</span></a></a><span> </span><a name="local-6989586621679030067"><a href="#local-6989586621679030067"><span class="hs-operator">&amp;&amp;</span></a></a><span>
</span><a name="line-460"></a><span>    </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr1</span><span> </span><span class="hs-identifier hs-var">i</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr2</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n1</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">cmpUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-463"></a><span class="hs-identifier">cmpUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ordering</span><span>
</span><a name="line-464"></a><span class="hs-identifier">cmpUArray</span><span> </span><span class="hs-identifier">arr1</span><span> </span><span class="hs-identifier">arr2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">assocs</span><span> </span><span class="hs-identifier">arr1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">assocs</span><span> </span><span class="hs-identifier">arr2</span><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span>
</span><a name="line-466"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">cmpIntUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-467"></a><span class="hs-identifier">cmpIntUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ordering</span><span>
</span><a name="line-468"></a><span class="hs-identifier">cmpIntUArray</span><span> </span><span class="hs-identifier">arr1</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l1</span><span> </span><span class="hs-identifier">u1</span><span> </span><span class="hs-identifier">n1</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arr2</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l2</span><span> </span><span class="hs-identifier">u2</span><span> </span><span class="hs-identifier">n2</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-469"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">n1</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">n2</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-operator hs-type">==</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">EQ</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-type">LT</span></a><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-470"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a name="cmpIntUArray"><a href="Data.Array.Base.html#cmpIntUArray"><span class="hs-identifier">n2</span></a></a><span> </span><a name="cmpIntUArray"><a href="Data.Array.Base.html#cmpIntUArray"><span class="hs-operator">==</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-var">GT</span></a><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-identifier">l1</span><span> </span><span class="hs-identifier">l2</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-472"></a><span>        </span><span class="hs-identifier">EQ</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">foldr</span><span> </span><span class="hs-identifier">cmp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">compare</span><span> </span><span class="hs-identifier">u1</span><span> </span><span class="hs-identifier">u2</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">n1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">min</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">n2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-473"></a><span>        </span><span class="hs-identifier">other</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">other</span><span>
</span><a name="line-474"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-identifier">cmp</span><span> </span><a name="local-6989586621679030088"><a href="#local-6989586621679030088"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">rest</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr1</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr2</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-476"></a><span>        </span><span class="hs-identifier">EQ</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">rest</span><span>
</span><a name="line-477"></a><span>        </span><span class="hs-identifier">other</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">other</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-pragma">{-# RULES</span><span> </span><span class="hs-pragma">&quot;cmpUArray/Int&quot;</span><span> </span><span class="hs-pragma">cmpUArray</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">cmpIntUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-480"></a><span>
</span><a name="line-481"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- Showing IArrays</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span class="hs-pragma">{-# SPECIALISE</span><span>
</span><a name="line-485"></a><span>    </span><span class="hs-pragma">showsIArray</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">IArray</span><span> </span><span class="hs-pragma">UArray</span><span> </span><span class="hs-pragma">e</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Ix</span><span> </span><span class="hs-pragma">i</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Show</span><span> </span><span class="hs-pragma">i</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Show</span><span> </span><span class="hs-pragma">e</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">=&gt;</span><span>
</span><a name="line-486"></a><span>                   </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">UArray</span><span> </span><span class="hs-pragma">i</span><span> </span><span class="hs-pragma">e</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">ShowS</span><span>
</span><a name="line-487"></a><span>  </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-identifier">showsIArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ShowS</span><span>
</span><a name="line-490"></a><span class="hs-identifier">showsIArray</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-491"></a><span>    </span><span class="hs-identifier">showParen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-number">9</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span>
</span><a name="line-492"></a><span>    </span><span class="hs-identifier">showString</span><span> </span><span class="hs-string">&quot;array &quot;</span><span> </span><span class="hs-operator">.</span><span>
</span><a name="line-493"></a><span>    </span><a name="showsIArray"><a href="Data.Array.Base.html#showsIArray"><span class="hs-identifier">shows</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span>
</span><a name="line-494"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Show.html#showParen"><span class="hs-identifier hs-var">showChar</span></a><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-495"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Show.html#showString"><span class="hs-identifier hs-var">shows</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">assocs</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- Flat unboxed arrays: instances</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-502"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-504"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-505"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-506"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-508"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isTrue#</span><span>
</span><a name="line-509"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">indexWordArray#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.ST.html#runST"><span class="hs-identifier hs-var">arr#</span></a><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#unsafeArrayUArray"><span class="hs-identifier hs-var">bOOL_INDEX</span></a><span> </span><a href="Data.Array.Base.html#unsafeArrayUArray"><span class="hs-identifier hs-var">i#</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">and#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">bOOL_BIT</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier">neWord#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">int2Word#</span><span> </span><span class="hs-number">0#</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-513"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier hs-var">arr</span><span> </span><span class="hs-identifier hs-var">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-515"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-517"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Char</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-520"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-521"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-524"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-525"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-char">'\0'</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-527"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">C#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWideCharArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-529"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-531"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-533"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-536"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-539"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">I#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexIntArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-547"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-548"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-549"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Word</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-552"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-553"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-554"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-555"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-556"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-557"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-558"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-559"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">W#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWordArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-561"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-563"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-565"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-568"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-569"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-571"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-572"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-identifier">nullPtr</span><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-575"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexAddrArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-579"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-581"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-584"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-585"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-586"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-587"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-588"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-589"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-identifier">nullFunPtr</span><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-591"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexAddrArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-593"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-594"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-595"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-597"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Float</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-601"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-602"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-603"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-604"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-605"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-607"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">F#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexFloatArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-609"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-611"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-612"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-613"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Double</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-616"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-617"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-619"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-620"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-621"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-623"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">D#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexDoubleArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-624"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-625"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-627"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-629"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StablePtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-632"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-633"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-634"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-635"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-636"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-637"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-identifier">nullStablePtr</span><span class="hs-special">)</span><span>
</span><a name="line-638"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-639"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StablePtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexStablePtrArray#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-641"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-643"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-644"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-645"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-646"></a><span>
</span><a name="line-647"></a><span class="hs-comment">-- bogus StablePtr value for initialising a UArray of StablePtr.</span><span>
</span><a name="line-648"></a><span class="hs-identifier">nullStablePtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">StablePtr</span><span> </span><a name="local-6989586621679029425"><a href="#local-6989586621679029425"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-649"></a><span class="hs-identifier">nullStablePtr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">StablePtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeCoerce#</span><span> </span><span class="hs-number">0#</span><span class="hs-special">)</span><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int8</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-652"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-653"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-655"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-656"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-657"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-659"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">I8#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexInt8Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-661"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-663"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-664"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-665"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int16</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-668"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-669"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-671"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-672"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-673"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-675"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">I16#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexInt16Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-677"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-679"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-681"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int32</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-684"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-685"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-687"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-688"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-689"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-690"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-691"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">I32#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexInt32Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-692"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-693"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-694"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-695"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-696"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-697"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Int64</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-700"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-701"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-703"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-704"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-705"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-706"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-707"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">I64#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexInt64Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-709"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-710"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-711"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-712"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-713"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-716"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-717"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-718"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-719"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-720"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-721"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-723"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">W8#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWord8Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-725"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-727"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-729"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Word16</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-732"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-733"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-734"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-735"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-736"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-737"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-738"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-739"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">W16#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWord16Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-741"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-742"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-743"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-745"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Word32</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-749"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-751"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-752"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-753"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-754"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-755"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">W32#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWord32Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-756"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-757"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-758"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-759"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-761"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">Word64</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-764"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-765"></a><span>    </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">numElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-767"></a><span>    </span><span class="hs-identifier">numElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-768"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-769"></a><span>    </span><span class="hs-identifier">unsafeArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeArrayUArray</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-771"></a><span>    </span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">W64#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indexWord64Array#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeReplace</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-773"></a><span>    </span><span class="hs-identifier">unsafeReplace</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeReplaceUArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccum</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-775"></a><span>    </span><span class="hs-identifier">unsafeAccum</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeAccumArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-777"></a><span>    </span><span class="hs-identifier">unsafeAccumArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAccumArrayUArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-identifier">lu</span><span> </span><span class="hs-identifier">ies</span><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>
</span><a name="line-779"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">ix</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-780"></a><span>    </span><span class="hs-special">(</span><a name="local-8214565720323797669"><a href="Data.Array.Base.html#unsafeAccumArray"><span class="hs-operator">==</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-8214565720323797669"><a href="Data.Array.Base.html#unsafeAccumArray"><span class="hs-identifier">eqUArray</span></a></a><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029281"><span class="hs-identifier hs-type">ix</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-783"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cmpUArray</span><span>
</span><a name="line-784"></a><span>
</span><a name="line-785"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Ix"><span class="hs-identifier hs-type">Ix</span></a><span> </span><a href="#local-6989586621679029279"><span class="hs-identifier hs-type">ix</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-identifier">ix</span><span class="hs-special">,</span><span> </span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">Show</span></a><span> </span><a href="Data.Array.Base.html#UArray"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-786"></a><span>    </span><span class="hs-identifier">showsPrec</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">showsIArray</span><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-789"></a><span class="hs-comment">-- Mutable arrays</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">arrEleBottom</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-792"></a><span class="hs-identifier">arrEleBottom</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-793"></a><span class="hs-identifier">arrEleBottom</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;MArray: undefined array element&quot;</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-comment">{-| Class of mutable array types.

An array type has the form @(a i e)@ where @a@ is the array type
constructor (kind @* -&gt; * -&gt; *@), @i@ is the index type (a member of
the class 'Ix'), and @e@ is the element type.

The @MArray@ class is parameterised over both @a@ and @e@ (so that
instances specialised to certain element types can be defined, in the
same way as for 'IArray'), and also over the type of the monad, @m@,
in which the mutable array will be manipulated.
-}</span><span>
</span><a name="line-806"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Monad</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span>    </span><span class="hs-comment">-- | Returns the bounds of the array</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-identifier">getBounds</span><span>      </span><span class="hs-glyph">::</span><span> </span><a name="MArray"><a href="Data.Array.Base.html#MArray"><span class="hs-identifier">Ix</span></a></a><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="local-6989586621679027501"><a href="#local-6989586621679027501"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>    </span><span class="hs-comment">-- | Returns the number of elements in the array</span><span>
</span><a name="line-811"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span>    </span><span class="hs-comment">-- | Builds a new array, with every element initialised to the supplied</span><span>
</span><a name="line-814"></a><span>    </span><span class="hs-comment">-- value.</span><span>
</span><a name="line-815"></a><span>    </span><span class="hs-identifier">newArray</span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-816"></a><span>
</span><a name="line-817"></a><span>    </span><span class="hs-comment">-- | Builds a new array, with every element initialised to an</span><span>
</span><a name="line-818"></a><span>    </span><span class="hs-comment">-- undefined value. In a monadic context in which operations must</span><span>
</span><a name="line-819"></a><span>    </span><span class="hs-comment">-- be deterministic (e.g. the ST monad), the array elements are</span><span>
</span><a name="line-820"></a><span>    </span><span class="hs-comment">-- initialised to a fixed but undefined value, such as zero.</span><span>
</span><a name="line-821"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>
</span><a name="line-823"></a><span>    </span><span class="hs-comment">-- | Builds a new array, with every element initialised to an undefined</span><span>
</span><a name="line-824"></a><span>    </span><span class="hs-comment">-- value.</span><span>
</span><a name="line-825"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-828"></a><span>    </span><a name="unsafeNewArray_"><a href="Data.Array.Base.html#unsafeNewArray_"><span class="hs-identifier">unsafeWrite</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679027499"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-831"></a><span>        </span><span class="hs-comment">-- The INLINE is crucial, because until we know at least which monad</span><span>
</span><a name="line-832"></a><span>        </span><span class="hs-comment">-- we are in, the code below allocates like crazy.  So inline it,</span><span>
</span><a name="line-833"></a><span>        </span><span class="hs-comment">-- in the hope that the context will know the monad.</span><span>
</span><a name="line-834"></a><span>    </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-835"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span>        </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span>        </span><span class="hs-identifier">sequence_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679027511"><a href="#local-6989586621679027511"><span class="hs-identifier">unsafeWrite</span></a></a><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-838"></a><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-839"></a><span>
</span><a name="line-840"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-841"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">arrEleBottom</span><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-844"></a><span>    </span><a name="local-8214565720323797656"><a href="Data.Array.Base.html#unsafeNewArray_"><span class="hs-identifier">newArray_</span></a></a><span> </span><span class="hs-special">(</span><a name="local-8214565720323797656"><a href="Data.Array.Base.html#unsafeNewArray_"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-8214565720323797656"><a href="Data.Array.Base.html#unsafeNewArray_"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">arrEleBottom</span><span>
</span><a name="line-845"></a><span>
</span><a name="line-846"></a><span>    </span><span class="hs-comment">-- newArray takes an initialiser which all elements of</span><span>
</span><a name="line-847"></a><span>    </span><span class="hs-comment">-- the newly created array are initialised to.  unsafeNewArray_ takes</span><span>
</span><a name="line-848"></a><span>    </span><span class="hs-comment">-- no initialiser, it is assumed that the array is initialised with</span><span>
</span><a name="line-849"></a><span>    </span><span class="hs-comment">-- &quot;undefined&quot; values.</span><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><span>    </span><span class="hs-comment">-- why not omit unsafeNewArray_?  Because in the unboxed array</span><span>
</span><a name="line-852"></a><span>    </span><span class="hs-comment">-- case we would like to omit the initialisation altogether if</span><span>
</span><a name="line-853"></a><span>    </span><span class="hs-comment">-- possible.  We can't do this for boxed arrays, because the</span><span>
</span><a name="line-854"></a><span>    </span><span class="hs-comment">-- elements must all have valid values at all times in case of</span><span>
</span><a name="line-855"></a><span>    </span><span class="hs-comment">-- garbage collection.</span><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span>    </span><span class="hs-comment">-- why not omit newArray?  Because in the boxed case, we can omit the</span><span>
</span><a name="line-858"></a><span>    </span><span class="hs-comment">-- default initialisation with undefined values if we *do* know the</span><span>
</span><a name="line-859"></a><span>    </span><span class="hs-comment">-- initial value and it is constant for all elements.</span><span>
</span><a name="line-860"></a><span>
</span><a name="line-861"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-862"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-863"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stToIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-864"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-865"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stToIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-866"></a><span>    </span><a name="local-8214565720323797652"><a href="Data.Array.Base.html#getBounds"><span class="hs-identifier">newArray</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newIOArray</span><span>
</span><a name="line-867"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeReadIOArray</span><span>
</span><a name="line-868"></a><span>    </span><a name="local-8214565720323797653"><a href="Data.Array.Base.html#getNumElements"><span class="hs-identifier">unsafeWrite</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeWriteIOArray</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newListArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-871"></a><span class="hs-comment">-- | Constructs a mutable array from a list of initial elements.</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- The list gives the elements of the array in ascending order</span><span>
</span><a name="line-873"></a><span class="hs-comment">-- beginning with the lowest index.</span><span>
</span><a name="line-874"></a><span class="hs-identifier">newListArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">e</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-875"></a><span class="hs-identifier">newListArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">es</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-876"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-877"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-878"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fillFromList</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">n</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-879"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">xs</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-880"></a><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>            </span><a name="local-6989586621679030096"><a href="#local-6989586621679030096"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679030096"><a href="#local-6989586621679030096"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">y</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#return"><span class="hs-operator hs-var">&gt;&gt;</span></a><span> </span><span class="hs-identifier">fillFromList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-882"></a><span>    </span><span class="hs-identifier">fillFromList</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">es</span><span>
</span><a name="line-883"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">readArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-886"></a><span class="hs-comment">-- | Read an element from a mutable array</span><span>
</span><a name="line-887"></a><span class="hs-identifier">readArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-888"></a><span class="hs-identifier">readArray</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-889"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-890"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-891"></a><span>  </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">writeArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-894"></a><span class="hs-comment">-- | Write an element in a mutable array</span><span>
</span><a name="line-895"></a><span class="hs-identifier">writeArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span class="hs-identifier">writeArray</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-897"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-898"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-899"></a><span>  </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-900"></a><span>
</span><a name="line-901"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getElems</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-902"></a><span class="hs-comment">-- | Return a list of all the elements of a mutable array</span><span>
</span><a name="line-903"></a><span class="hs-identifier">getElems</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">e</span><span class="hs-special">]</span><span>
</span><a name="line-904"></a><span class="hs-identifier">getElems</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-905"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_l</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-906"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-907"></a><span>  </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-908"></a><span>
</span><a name="line-909"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getAssocs</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-910"></a><span class="hs-comment">-- | Return a list of all the associations of a mutable array, in</span><span>
</span><a name="line-911"></a><span class="hs-comment">-- index order.</span><span>
</span><a name="line-912"></a><span class="hs-identifier">getAssocs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-913"></a><span class="hs-identifier">getAssocs</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-914"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-915"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-916"></a><span>  </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="Data.Array.Base.html#getBounds"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">range</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mapArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- | Constructs a new array derived from the original array by applying a</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- function to each of the elements.</span><span>
</span><a name="line-922"></a><span class="hs-identifier">mapArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-923"></a><span class="hs-identifier">mapArray</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-924"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-925"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-926"></a><span>  </span><a name="mapArray"><a href="Data.Array.Base.html#mapArray"><span class="hs-identifier">marr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-identifier">sequence_</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><a href="Data.Array.Base.html#getBounds"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span>
</span><a name="line-928"></a><span>                </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr'</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-929"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="Data.Array.Base.html#newArray_"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-930"></a><span>  </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier">marr'</span><span>
</span><a name="line-931"></a><span>
</span><a name="line-932"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mapIndices</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-933"></a><span class="hs-comment">-- | Constructs a new array derived from the original array by applying a</span><span>
</span><a name="line-934"></a><span class="hs-comment">-- function to each of the indices.</span><span>
</span><a name="line-935"></a><span class="hs-identifier">mapIndices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">j</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">j</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">j</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-936"></a><span class="hs-identifier">mapIndices</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l'</span><span class="hs-special">,</span><span class="hs-identifier">u'</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-937"></a><span>    </span><span class="hs-identifier">marr'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l'</span><span class="hs-special">,</span><span class="hs-identifier">u'</span><span class="hs-special">)</span><span>
</span><a name="line-938"></a><span>    </span><span class="hs-identifier">n'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr'</span><span>
</span><a name="line-939"></a><span>    </span><span class="hs-identifier">sequence_</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readArray</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">i'</span><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>                  </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safeIndex</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l'</span><span class="hs-special">,</span><span class="hs-identifier">u'</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">n'</span><span> </span><span class="hs-identifier">i'</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span>
</span><a name="line-941"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="Data.Array.Base.html#getNumElements"><span class="hs-identifier hs-var">i'</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">range</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l'</span><span class="hs-special">,</span><span class="hs-identifier">u'</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-942"></a><span>    </span><a href="../base/src/%{MODULE}.html#%{NAME}/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-identifier">marr'</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- Polymorphic non-strict mutable arrays (ST monad)</span><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-948"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-949"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">ArrST.boundsSTArray</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-950"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-951"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">ArrST.numElementsSTArray</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-952"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-953"></a><span>    </span><span class="hs-identifier">newArray</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ArrST.newSTArray</span><span>
</span><a name="line-954"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-955"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ArrST.unsafeReadSTArray</span><span>
</span><a name="line-956"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-957"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ArrST.unsafeWriteSTArray</span><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Lazy.ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-960"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-961"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">ArrST.boundsSTArray</span><span> </span><span class="hs-identifier">arr</span><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-963"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">ArrST.numElementsSTArray</span><span> </span><span class="hs-identifier">arr</span><span class="hs-special">)</span><span>
</span><a name="line-964"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-965"></a><span>    </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ArrST.newSTArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-966"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-967"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ArrST.unsafeReadSTArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-968"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-969"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictToLazyST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ArrST.unsafeWriteSTArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-972"></a><span class="hs-comment">-- Flat unboxed mutable arrays (ST monad)</span><span>
</span><a name="line-973"></a><span>
</span><a name="line-974"></a><span class="hs-comment">-- | A mutable array with unboxed elements, that can be manipulated in</span><span>
</span><a name="line-975"></a><span class="hs-comment">-- the 'ST' monad.  The type arguments are as follows:</span><span>
</span><a name="line-976"></a><span class="hs-comment">--</span><span>
</span><a name="line-977"></a><span class="hs-comment">--  * @s@: the state variable argument for the 'ST' type</span><span>
</span><a name="line-978"></a><span class="hs-comment">--</span><span>
</span><a name="line-979"></a><span class="hs-comment">--  * @i@: the index type of the array (should be an instance of @Ix@)</span><span>
</span><a name="line-980"></a><span class="hs-comment">--</span><span>
</span><a name="line-981"></a><span class="hs-comment">--  * @e@: the element type of the array.  Only certain element types</span><span>
</span><a name="line-982"></a><span class="hs-comment">--    are supported.</span><span>
</span><a name="line-983"></a><span class="hs-comment">--</span><span>
</span><a name="line-984"></a><span class="hs-comment">-- An 'STUArray' will generally be more efficient (in terms of both time</span><span>
</span><a name="line-985"></a><span class="hs-comment">-- and space) than the equivalent boxed version ('STArray') with the same</span><span>
</span><a name="line-986"></a><span class="hs-comment">-- element type.  However, 'STUArray' is strict in its elements - so</span><span>
</span><a name="line-987"></a><span class="hs-comment">-- don\'t use 'STUArray' if you require the non-strictness that</span><span>
</span><a name="line-988"></a><span class="hs-comment">-- 'STArray' provides.</span><span>
</span><a name="line-989"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">Int</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MutableByteArray#</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><a name="line-990"></a><span class="hs-comment">-- The &quot;ST&quot; parameter must be nominal for the safety of the ST trick.</span><span>
</span><a name="line-991"></a><span class="hs-comment">-- The other parameters have class constraints. See also #9220.</span><span>
</span><a name="line-992"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">role</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">nominal</span><span> </span><span class="hs-identifier">nominal</span><span> </span><span class="hs-identifier">nominal</span><span>
</span><a name="line-993"></a><span>
</span><a name="line-994"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-995"></a><span>    </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr1#</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">arr2#</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-996"></a><span>        </span><span class="hs-identifier">isTrue#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sameMutableByteArray#</span><span> </span><span class="hs-identifier">arr1#</span><span> </span><span class="hs-identifier">arr2#</span><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>
</span><a name="line-998"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArraySTUArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-999"></a><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-var">Ix</span><span> </span><span class="hs-identifier hs-var">i</span><span>
</span><a name="line-1000"></a><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-special">,</span><span class="hs-identifier">i</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">elemsToBytes</span><span>
</span><a name="line-1002"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">rangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1003"></a><span>       </span><span class="hs-identifier">n</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1004"></a><span>           </span><a name="unsafeNewArraySTUArray_"><a href="Data.Array.Base.html#unsafeNewArraySTUArray_"><span class="hs-identifier">ST</span></a></a><span> </span><a name="unsafeNewArraySTUArray_"><a href="Data.Array.Base.html#unsafeNewArraySTUArray_"><span class="hs-operator">$</span></a></a><span> </span><span class="hs-glyph">\</span><a name="unsafeNewArraySTUArray_"><a href="Data.Array.Base.html#unsafeNewArraySTUArray_"><span class="hs-identifier">s1#</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1005"></a><span>               </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">newByteArray#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">elemsToBytes</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1006"></a><span>                   </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1007"></a><span>                       </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span>
</span><a name="line-1008"></a><span>
</span><a name="line-1009"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1010"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1011"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1012"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1013"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1014"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1015"></a><span>    </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1016"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>                   </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1017"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bOOL_SCALE</span><span> </span><span class="hs-identifier">n#</span><span>                         </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">nbytes#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1018"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">newByteArray#</span><span> </span><span class="hs-identifier">nbytes#</span><span> </span><span class="hs-identifier">s1#</span><span>             </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1019"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">setByteArray#</span></a><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-number">0#</span><span> </span><span class="hs-identifier">nbytes#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s3#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1020"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s3#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><a href="#local-6989586621679029130"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1021"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1022"></a><span>        </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier hs-var">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">initialValue</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-number">0xff</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-number">0x0</span><span>
</span><a name="line-1023"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1024"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">bOOL_SCALE</span><span>
</span><a name="line-1025"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1026"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-1027"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1029"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWordArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">bOOL_INDEX</span><span> </span><span class="hs-identifier hs-var">i#</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1030"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isTrue#</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">and#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">bOOL_BIT</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">neWord#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">int2Word#</span><span> </span><span class="hs-number">0#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1031"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1032"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679029138"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679029138"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#bOOL_INDEX"><span class="hs-identifier hs-var">I#</span></a><span> </span><a href="Data.Array.Base.html#bOOL_INDEX"><span class="hs-identifier hs-var">i#</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029139"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679029140"><span class="hs-identifier hs-var">ST</span></a><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1033"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bOOL_INDEX</span><span> </span><span class="hs-identifier">i#</span><span>              </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><a href="#local-6989586621679029139"><span class="hs-identifier hs-var">j#</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1034"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWordArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">j#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">old#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1035"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">old#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">or#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">bOOL_BIT</span><span> </span><a name="local-6989586621679029144"><a href="#local-6989586621679029144"><span class="hs-identifier">i#</span></a></a><span>
</span><a name="line-1036"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="Data.Array.Base.html#bOOL_INDEX"><span class="hs-identifier hs-var">old#</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">and#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">bOOL_NOT_BIT</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1037"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWordArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">j#</span><span> </span><a href="#local-6989586621679029146"><span class="hs-identifier hs-var">e#</span></a><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s3#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1038"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s3#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029143"><span class="hs-identifier hs-var">Char</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029147"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679029150"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1041"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1042"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1044"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1045"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1046"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">4#</span><span class="hs-special">)</span><span>
</span><a name="line-1047"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1048"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">chr</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1050"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1051"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWideCharArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679029094"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679029094"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1052"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">C#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1053"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1054"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679029110"><span class="hs-identifier hs-var">marr#</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">C#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWideCharArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1056"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1057"></a><span>
</span><a name="line-1058"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Int</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029115"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679029115"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1059"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1060"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1062"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1063"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1064"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span>
</span><a name="line-1065"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1066"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1067"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1068"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1069"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readIntArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-identifier">i#</span><span> </span><a href="#local-6989586621679029077"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1070"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1071"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1072"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679029078"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679029078"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679029081"><a href="#local-6989586621679029081"><span class="hs-identifier">I#</span></a></a><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1073"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeIntArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1074"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029083"><span class="hs-identifier hs-var">Word</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><a href="#local-6989586621679029085"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1077"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1078"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1079"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1080"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1081"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1082"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span>
</span><a name="line-1083"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1084"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1085"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1086"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1087"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWordArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-identifier">i#</span><span> </span><a href="#local-6989586621679029060"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1088"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">W#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1089"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1090"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679029061"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679029061"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">W#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1091"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWordArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1092"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1093"></a><span>
</span><a name="line-1094"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029066"><span class="hs-identifier hs-var">Ptr</span></a><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029068"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679029069"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1095"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1096"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1097"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1098"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1099"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span>
</span><a name="line-1101"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1102"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1103"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1104"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1105"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readAddrArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-identifier">i#</span><span> </span><a href="#local-6989586621679029043"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Ptr.html#nullPtr"><span class="hs-identifier hs-var">s2#</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1106"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1107"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1108"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679029044"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679029044"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1109"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeAddrArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1110"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1111"></a><span>
</span><a name="line-1112"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679029052"><span class="hs-identifier hs-var">ST</span></a><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1113"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1114"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1116"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1117"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1118"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span>
</span><a name="line-1119"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1120"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-identifier">nullFunPtr</span><span>
</span><a name="line-1121"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1122"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1123"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readAddrArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-identifier">i#</span><span> </span><a href="#local-6989586621679029025"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Ptr.html#nullFunPtr"><span class="hs-identifier hs-var">s2#</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1124"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1125"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1126"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679029026"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679029026"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1127"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeAddrArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1128"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1129"></a><span>
</span><a name="line-1130"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679029031"><span class="hs-identifier hs-var">Float</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><a href="#local-6989586621679029033"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1131"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1132"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1134"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1135"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1136"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fLOAT_SCALE</span><span>
</span><a name="line-1137"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1138"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1139"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1140"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1141"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readFloatArray#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><a href="#local-6989586621679029007"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679029007"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1142"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">F#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1143"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1144"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679029008"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">F#</span><span> </span><a name="local-6989586621679029011"><a href="#local-6989586621679029011"><span class="hs-identifier">e#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1145"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeFloatArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1146"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1147"></a><span>
</span><a name="line-1148"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Double</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><a href="#local-6989586621679029015"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1149"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1150"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1151"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1152"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1153"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1154"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dOUBLE_SCALE</span><span>
</span><a name="line-1155"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1156"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1157"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1158"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1159"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readDoubleArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679028990"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028990"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1160"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">D#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1161"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1162"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679028991"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028993"><span class="hs-identifier hs-var">I#</span></a><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">D#</span><span> </span><a name="local-6989586621679028994"><a href="#local-6989586621679028994"><span class="hs-identifier">e#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1163"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeDoubleArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1164"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StablePtr</span><span> </span><a href="#local-6989586621679028998"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028999"><span class="hs-identifier hs-var">ST</span></a><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1167"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1168"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1170"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1171"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1172"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span>
</span><a name="line-1173"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1174"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtrToStablePtr</span><span> </span><span class="hs-identifier">nullPtr</span><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1176"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1177"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readStablePtrArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679028973"><span class="hs-identifier hs-var">i#</span></a><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Stable.html#castPtrToStablePtr"><span class="hs-identifier hs-var">s2#</span></a><span class="hs-special">,</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Stable.html#castPtrToStablePtr"><span class="hs-identifier hs-var">e#</span></a><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1178"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">StablePtr</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1179"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1180"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><a href="#local-6989586621679028976"><span class="hs-identifier hs-var">i#</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StablePtr</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1181"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeStablePtrArray#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1182"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Int8</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028979"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028979"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1185"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1186"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1187"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1188"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1189"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1190"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1192"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1193"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1194"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1195"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readInt8Array#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><span class="hs-identifier">i#</span><span> </span><a href="#local-6989586621679028955"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1196"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">I8#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1198"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679028956"><span class="hs-identifier hs-var">_</span></a><span> </span><a href="#local-6989586621679028956"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I8#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1199"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeInt8Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1200"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679028961"><span class="hs-identifier hs-var">Int16</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><a href="#local-6989586621679028963"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1203"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1204"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1205"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1206"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1207"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1208"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">2#</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1210"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1211"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1213"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readInt16Array#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><a href="#local-6989586621679028937"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028937"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1214"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">I16#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1215"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1216"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679028938"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I16#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1217"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeInt16Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1218"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1219"></a><span>
</span><a name="line-1220"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Int32</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028944"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028945"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1221"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1222"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1223"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1224"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1225"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1226"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">4#</span><span class="hs-special">)</span><span>
</span><a name="line-1227"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1228"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1229"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1230"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1231"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readInt32Array#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><a href="#local-6989586621679028920"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028920"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1232"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">I32#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1233"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1234"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679028921"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I32#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1235"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeInt32Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1236"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Int64</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028927"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028928"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1239"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1240"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1242"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1243"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1244"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">8#</span><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1246"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1247"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1248"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1249"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readInt64Array#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><a href="#local-6989586621679028903"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028903"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1250"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">I64#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1251"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1252"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679028904"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I64#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1253"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeInt64Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1254"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028910"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028911"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1257"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1258"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1259"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1260"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1261"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1262"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span>
</span><a name="line-1263"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1264"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1265"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1266"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1267"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWord8Array#</span><span> </span><a href="Data.Array.Base.html#newArray"><span class="hs-identifier hs-var">marr#</span></a><span> </span><a href="#local-6989586621679028886"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028886"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1268"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">W8#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1269"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1270"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679028887"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">W8#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1271"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWord8Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1272"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Word16</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ST</span><span> </span><a href="#local-6989586621679028894"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1275"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1276"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1278"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1279"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1280"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">2#</span><span class="hs-special">)</span><span>
</span><a name="line-1281"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1282"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1283"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1284"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1285"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWord16Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679028868"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028868"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1286"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">W16#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1288"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679028869"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028871"><span class="hs-identifier hs-var">I#</span></a><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">W16#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1289"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWord16Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1290"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Word32</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028875"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028876"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1293"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1294"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1295"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1296"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1297"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1298"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">4#</span><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1300"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1301"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1302"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1303"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWord32Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679028851"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028851"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1304"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">W32#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1305"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1306"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679028852"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028854"><span class="hs-identifier hs-var">I#</span></a><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">W32#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1307"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWord32Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1308"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">s</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Word64</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028858"><span class="hs-identifier hs-var">ST</span></a><span> </span><a href="#local-6989586621679028859"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1311"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getBounds</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1312"></a><span>    </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1313"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getNumElements</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1314"></a><span>    </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1315"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeNewArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-identifier">unsafeNewArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeNewArraySTUArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-number">8#</span><span class="hs-special">)</span><span>
</span><a name="line-1317"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newArray_</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1318"></a><span>    </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">newArray</span><span> </span><span class="hs-identifier">arrBounds</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1319"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeRead</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1320"></a><span>    </span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1321"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">readWord64Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><a href="#local-6989586621679028834"><span class="hs-identifier hs-var">i#</span></a><span> </span><a href="#local-6989586621679028834"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1322"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">W64#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1323"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeWrite</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1324"></a><span>    </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">STUArray</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><span class="hs-identifier hs-var">_</span><span> </span><a href="#local-6989586621679028835"><span class="hs-identifier hs-var">_</span></a><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028837"><span class="hs-identifier hs-var">I#</span></a><span> </span><span class="hs-identifier">i#</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">W64#</span><span> </span><span class="hs-identifier">e#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1325"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">writeWord64Array#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-identifier">e#</span><span> </span><span class="hs-identifier">s1#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">s2#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1326"></a><span>        </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1329"></a><span class="hs-comment">-- Translation between elements and bytes</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span class="hs-identifier">bOOL_SCALE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wORD_SCALE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dOUBLE_SCALE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fLOAT_SCALE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int#</span><span>
</span><a name="line-1332"></a><span class="hs-identifier">bOOL_SCALE</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1333"></a><span>    </span><span class="hs-comment">-- + 7 to handle case where n is not divisible by 8</span><span>
</span><a name="line-1334"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">n#</span><span> </span><span class="hs-operator">+#</span><span> </span><span class="hs-number">7#</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">uncheckedIShiftRA#</span><span class="hs-special">`</span><span> </span><span class="hs-number">3#</span><span>
</span><a name="line-1335"></a><a name="bOOL_SCALE"><a href="Data.Array.Base.html#bOOL_SCALE"><span class="hs-identifier">wORD_SCALE</span></a></a><span>   </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-identifier">scale#</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">scale#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SIZEOF_HSWORD</span><span>
</span><a name="line-1336"></a><span class="hs-identifier">dOUBLE_SCALE</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safe_scale</span><span> </span><span class="hs-identifier">scale#</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">scale#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SIZEOF_HSDOUBLE</span><span>
</span><a name="line-1337"></a><span class="hs-identifier">fLOAT_SCALE</span><span>  </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">safe_scale</span><span> </span><span class="hs-identifier hs-var">scale#</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">scale#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SIZEOF_HSFLOAT</span><span>
</span><a name="line-1338"></a><span>
</span><a name="line-1339"></a><a name="dOUBLE_SCALE"><a href="Data.Array.Base.html#dOUBLE_SCALE"><span class="hs-identifier">safe_scale</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Array.Base.html#safe_scale"><span class="hs-identifier hs-var">Int#</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679030452"><span class="hs-identifier hs-var">Int#</span></a><span>
</span><a name="line-1340"></a><a name="fLOAT_SCALE"><a href="Data.Array.Base.html#fLOAT_SCALE"><span class="hs-identifier">safe_scale</span></a></a><span> </span><span class="hs-identifier">scale#</span><span> </span><a href="Data.Array.Base.html#safe_scale"><span class="hs-identifier hs-var">n#</span></a><span>
</span><a name="line-1341"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">overflow</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">res#</span><span>
</span><a name="line-1342"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-operator hs-type">$</span><span> </span><span class="hs-string">&quot;Data.Array.Base.safe_scale: Overflow; scale: &quot;</span><span>
</span><a name="line-1343"></a><span>    </span><a name="safe_scale"><a href="Data.Array.Base.html#safe_scale"><span class="hs-operator">++</span></a></a><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679030455"><a href="#local-6989586621679030455"><span class="hs-identifier">I#</span></a></a><span> </span><span class="hs-identifier">scale#</span><span class="hs-special">)</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;, n: &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span>
</span><a name="line-1344"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1345"></a><span>    </span><span class="hs-glyph">!</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">res#</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">scale#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Err.html#error"><span class="hs-operator hs-var">*#</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Err.html#error"><span class="hs-identifier hs-var">n#</span></a><span>
</span><a name="line-1346"></a><span>    </span><span class="hs-glyph">!</span><span class="hs-identifier">overflow</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isTrue#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maxN#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">divInt#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">scale#</span><span> </span><span class="hs-operator">&lt;#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span>
</span><a name="line-1347"></a><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">maxN#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maxBound</span><span>
</span><a name="line-1348"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">safe_scale</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1349"></a><span>
</span><a name="line-1350"></a><span class="hs-comment">-- | The index of the word which the given @Bool@ array elements falls within.</span><span>
</span><a name="line-1351"></a><span class="hs-identifier">bOOL_INDEX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int#</span><span>
</span><a name="line-1352"></a><span class="hs-cpp">#if SIZEOF_HSWORD == 4
</span><span class="hs-identifier">bOOL_INDEX</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">uncheckedIShiftRA#</span><span class="hs-special">`</span><span> </span><span class="hs-number">5#</span><span>
</span><a name="line-1354"></a><span class="hs-cpp">#elif SIZEOF_HSWORD == 8
</span><span class="hs-identifier">bOOL_INDEX</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">i#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">uncheckedIShiftRA#</span><span class="hs-special">`</span><span> </span><span class="hs-number">6#</span><span>
</span><a name="line-1356"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1358"></a><a name="bOOL_INDEX"><a href="Data.Array.Base.html#bOOL_INDEX"><span class="hs-identifier">bOOL_BIT</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">bOOL_NOT_BIT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-var">Int#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Word#</span><span>
</span><a name="line-1359"></a><span class="hs-identifier">bOOL_BIT</span><span>     </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">int2Word#</span><span> </span><span class="hs-number">1#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">uncheckedShiftL#</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">word2Int#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">int2Word#</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">and#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mask#</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1360"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">W#</span><span> </span><span class="hs-identifier">mask#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SIZEOF_HSWORD</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1361"></a><span class="hs-identifier">bOOL_NOT_BIT</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bOOL_BIT</span><span> </span><span class="hs-identifier hs-type">n#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">xor#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mb#</span><span>
</span><a name="line-1362"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier">W#</span><span> </span><span class="hs-identifier">mb#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maxBound</span><span>
</span><a name="line-1363"></a><span>
</span><a name="line-1364"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1365"></a><span class="hs-comment">-- Freezing</span><span>
</span><a name="line-1366"></a><span>
</span><a name="line-1367"></a><span class="hs-comment">-- | Converts a mutable array (any instance of 'MArray') to an</span><span>
</span><a name="line-1368"></a><span class="hs-comment">-- immutable array (any instance of 'IArray') by taking a complete</span><span>
</span><a name="line-1369"></a><span class="hs-comment">-- copy of it.</span><span>
</span><a name="line-1370"></a><span class="hs-identifier">freeze</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1371"></a><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">freeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1372"></a><span class="hs-identifier">freeze</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getBounds</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-1374"></a><span>  </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getNumElements</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-1375"></a><span>  </span><a name="freeze"><a href="Data.Array.Base.html#freeze"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeRead</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span>
</span><a name="line-1376"></a><span>  </span><span class="hs-comment">-- The old array and index might not be well-behaved, so we need to</span><span>
</span><a name="line-1377"></a><span>  </span><span class="hs-comment">-- use the safe array creation function here.</span><span>
</span><a name="line-1378"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">listArray</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#unsafeRead"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679031017"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>
</span><a name="line-1380"></a><span class="hs-identifier">freezeSTUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1381"></a><span class="hs-identifier">freezeSTUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><a href="#local-6989586621679031021"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s1#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1382"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">sizeofMutableByteArray#</span><span> </span><span class="hs-identifier">marr#</span><span>  </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1383"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">newByteArray#</span><span> </span><a href="Data.Array.Base.html#STUArray"><span class="hs-identifier hs-type">n#</span></a><span> </span><span class="hs-identifier">s1#</span><span>           </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">marr'#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1384"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">memcpy_freeze</span><span> </span><span class="hs-identifier">marr'#</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1385"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce#</span><span> </span><span class="hs-identifier hs-var">m</span><span> </span><span class="hs-identifier hs-var">s2#</span><span>            </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s3#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1386"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unsafeFreezeByteArray#</span><span> </span><span class="hs-identifier">marr'#</span><span> </span><span class="hs-identifier">s3#</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s4#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1387"></a><span>    </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s4#</span><span class="hs-special">,</span><span> </span><a href="Data.Array.Base.html#memcpy_freeze"><span class="hs-identifier hs-var">UArray</span></a><span> </span><a href="Data.Array.Base.html#memcpy_freeze"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="Data.Array.Base.html#memcpy_freeze"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621679031029"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679031029"><span class="hs-identifier hs-var">arr#</span></a><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1388"></a><span>
</span><a name="line-1389"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;memcpy&quot;</span><span>
</span><a name="line-1390"></a><span>    </span><span class="hs-identifier">memcpy_freeze</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">MutableByteArray#</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">MutableByteArray#</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-1391"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1394"></a><span class="hs-pragma">&quot;freeze/STArray&quot;</span><span>  </span><span class="hs-pragma">freeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">ArrST.freezeSTArray</span><span>
</span><a name="line-1395"></a><span class="hs-pragma">&quot;freeze/STUArray&quot;</span><span> </span><span class="hs-pragma">freeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">freezeSTUArray</span><span>
</span><a name="line-1396"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1397"></a><span>
</span><a name="line-1398"></a><span class="hs-comment">-- In-place conversion of mutable arrays to immutable ones places</span><span>
</span><a name="line-1399"></a><span class="hs-comment">-- a proof obligation on the user: no other parts of your code can</span><span>
</span><a name="line-1400"></a><span class="hs-comment">-- have a reference to the array at the point where you unsafely</span><span>
</span><a name="line-1401"></a><span class="hs-comment">-- freeze it (and, subsequently mutate it, I suspect).</span><span>
</span><a name="line-1402"></a><span>
</span><a name="line-1403"></a><span class="hs-comment">{- |
   Converts an mutable array into an immutable array.  The
   implementation may either simply cast the array from
   one type to the other without copying the array, or it
   may take a full copy of the array.

   Note that because the array is possibly not copied, any subsequent
   modifications made to the mutable version of the array may be
   shared with the immutable version.  It is safe to use, therefore, if
   the mutable version is never modified after the freeze operation.

   The non-copying implementation is supported between certain pairs
   of array types only; one constraint is that the array types must
   have identical representations.  In GHC, The following pairs of
   array types have a non-copying O(1) implementation of
   'unsafeFreeze'.  Because the optimised versions are enabled by
   specialisations, you will need to compile with optimisation (-O) to
   get them.

     * 'Data.Array.IO.IOUArray' -&gt; 'Data.Array.Unboxed.UArray'

     * 'Data.Array.ST.STUArray' -&gt; 'Data.Array.Unboxed.UArray'

     * 'Data.Array.IO.IOArray' -&gt; 'Data.Array.Array'

     * 'Data.Array.ST.STArray' -&gt; 'Data.Array.Array'
-}</span><span>
</span><a name="line-1430"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">unsafeFreeze</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1431"></a><span class="hs-identifier">unsafeFreeze</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1432"></a><span class="hs-identifier">unsafeFreeze</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">freeze</span><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1435"></a><span class="hs-pragma">&quot;unsafeFreeze/STArray&quot;</span><span>  </span><span class="hs-pragma">unsafeFreeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">ArrST.unsafeFreezeSTArray</span><span>
</span><a name="line-1436"></a><span class="hs-pragma">&quot;unsafeFreeze/STUArray&quot;</span><span> </span><span class="hs-pragma">unsafeFreeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">unsafeFreezeSTUArray</span><span>
</span><a name="line-1437"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1438"></a><span>
</span><a name="line-1439"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1440"></a><span class="hs-comment">-- Thawing</span><span>
</span><a name="line-1441"></a><span>
</span><a name="line-1442"></a><span class="hs-comment">-- | Converts an immutable array (any instance of 'IArray') into a</span><span>
</span><a name="line-1443"></a><span class="hs-comment">-- mutable array (any instance of 'MArray') by taking a complete copy</span><span>
</span><a name="line-1444"></a><span class="hs-comment">-- of it.</span><span>
</span><a name="line-1445"></a><span class="hs-identifier">thaw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">thaw</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1447"></a><span class="hs-identifier">thaw</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">bounds</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1448"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1449"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newArray_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">l</span><span class="hs-special">,</span><span class="hs-identifier">u</span><span class="hs-special">)</span><span>
</span><a name="line-1450"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">safeRangeSize</span><span> </span><span class="hs-special">(</span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">,</span><a href="Data.Array.Base.html#MArray"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-1451"></a><span>    </span><span class="hs-identifier">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">unsafeWrite</span><span> </span><span class="hs-identifier">marr</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeAt</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><a name="line-1452"></a><span>              </span><span class="hs-glyph">|</span><span> </span><a href="Data.Array.Base.html#bounds"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-1453"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">marr</span><span>
</span><a name="line-1454"></a><span>
</span><a name="line-1455"></a><span class="hs-identifier">thawSTUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">UArray</span></a><span> </span><a href="Data.Array.Base.html#safeRangeSize"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1456"></a><span class="hs-identifier">thawSTUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Data.Array.Base.html#unsafeWrite"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-identifier">arr#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ST</span><span> </span><a href="Data.Array.Base.html#unsafeAt"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-glyph">\</span><a href="Data.Array.Base.html#unsafeAt"><span class="hs-identifier hs-var">s1#</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1457"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">sizeofByteArray#</span><span> </span><span class="hs-identifier">arr#</span><span>          </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1458"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">newByteArray#</span><span> </span><span class="hs-identifier">n#</span><span> </span><span class="hs-identifier">s1#</span><span>           </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s2#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">memcpy_thaw</span><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-identifier">arr#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">I#</span><span> </span><span class="hs-identifier">n#</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1460"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unsafeCoerce#</span><span> </span><a href="#local-6989586621679029579"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier">s2#</span><span>            </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(#</span><span> </span><span class="hs-identifier">s3#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1461"></a><span>    </span><span class="hs-special">(#</span><span> </span><a name="thawSTUArray"><a href="Data.Array.Base.html#thawSTUArray"><span class="hs-identifier">s3#</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><a name="local-6989586621679031554"><a href="#local-6989586621679031554"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679031555"><a href="#local-6989586621679031555"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621679031556"><a href="#local-6989586621679031556"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">marr#</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1462"></a><span>
</span><a name="line-1463"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;memcpy&quot;</span><span>
</span><a name="line-1464"></a><span>    </span><span class="hs-identifier">memcpy_thaw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">MutableByteArray#</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ByteArray#</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-1465"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Ptr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-1466"></a><span>
</span><a name="line-1467"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1468"></a><span class="hs-pragma">&quot;thaw/STArray&quot;</span><span>  </span><span class="hs-pragma">thaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">ArrST.thawSTArray</span><span>
</span><a name="line-1469"></a><span class="hs-pragma">&quot;thaw/STUArray&quot;</span><span> </span><span class="hs-pragma">thaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">thawSTUArray</span><span>
</span><a name="line-1470"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1471"></a><span>
</span><a name="line-1472"></a><span class="hs-comment">-- In-place conversion of immutable arrays to mutable ones places</span><span>
</span><a name="line-1473"></a><span class="hs-comment">-- a proof obligation on the user: no other parts of your code can</span><span>
</span><a name="line-1474"></a><span class="hs-comment">-- have a reference to the array at the point where you unsafely</span><span>
</span><a name="line-1475"></a><span class="hs-comment">-- thaw it (and, subsequently mutate it, I suspect).</span><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span class="hs-comment">{- |
   Converts an immutable array into a mutable array.  The
   implementation may either simply cast the array from
   one type to the other without copying the array, or it
   may take a full copy of the array.

   Note that because the array is possibly not copied, any subsequent
   modifications made to the mutable version of the array may be
   shared with the immutable version.  It is only safe to use,
   therefore, if the immutable array is never referenced again in this
   thread, and there is no possibility that it can be also referenced
   in another thread.  If you use an unsafeThaw/write/unsafeFreeze
   sequence in a multi-threaded setting, then you must ensure that
   this sequence is atomic with respect to other threads, or a garbage
   collector crash may result (because the write may be writing to a
   frozen array).

   The non-copying implementation is supported between certain pairs
   of array types only; one constraint is that the array types must
   have identical representations.  In GHC, The following pairs of
   array types have a non-copying O(1) implementation of
   'unsafeThaw'.  Because the optimised versions are enabled by
   specialisations, you will need to compile with optimisation (-O) to
   get them.

     * 'Data.Array.Unboxed.UArray' -&gt; 'Data.Array.IO.IOUArray'

     * 'Data.Array.Unboxed.UArray' -&gt; 'Data.Array.ST.STUArray'

     * 'Data.Array.Array'  -&gt; 'Data.Array.IO.IOArray'

     * 'Data.Array.Array'  -&gt; 'Data.Array.ST.STArray'
-}</span><span>
</span><a name="line-1510"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">[</span><span class="hs-pragma">1</span><span class="hs-pragma">]</span><span> </span><span class="hs-pragma">unsafeThaw</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1511"></a><span class="hs-identifier">unsafeThaw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ix</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IArray</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">MArray</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-identifier">m</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1512"></a><span class="hs-identifier">unsafeThaw</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">thaw</span><span>
</span><a name="line-1513"></a><span>
</span><a name="line-1514"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeThawSTUArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1515"></a><span class="hs-identifier">unsafeThawSTUArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span class="hs-identifier">unsafeThawSTUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">UArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1517"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">l</span></a><span> </span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">u</span></a><span> </span><a href="Data.Array.Base.html#IArray"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unsafeCoerce#</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1518"></a><span>
</span><a name="line-1519"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1520"></a><span class="hs-pragma">&quot;unsafeThaw/STArray&quot;</span><span>    </span><span class="hs-pragma">unsafeThaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">ArrST.unsafeThawSTArray</span><span>
</span><a name="line-1521"></a><span class="hs-pragma">&quot;unsafeThaw/STUArray&quot;</span><span>   </span><span class="hs-pragma">unsafeThaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">unsafeThawSTUArray</span><span>
</span><a name="line-1522"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1523"></a><span>
</span><a name="line-1524"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeThawIOArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1525"></a><span class="hs-identifier">unsafeThawIOArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Arr.Array</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1526"></a><span class="hs-identifier">unsafeThawIOArray</span><span> </span><span class="hs-identifier">arr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Array.Base.html#unsafeThaw"><span class="hs-identifier hs-var">stToIO</span></a><span> </span><a href="Data.Array.Base.html#unsafeThaw"><span class="hs-operator hs-var">$</span></a><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1527"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ArrST.unsafeThawSTArray</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-1528"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span>
</span><a name="line-1529"></a><span>
</span><a name="line-1530"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1531"></a><span class="hs-pragma">&quot;unsafeThaw/IOArray&quot;</span><span>  </span><span class="hs-pragma">unsafeThaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">unsafeThawIOArray</span><span>
</span><a name="line-1532"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1533"></a><span>
</span><a name="line-1534"></a><span class="hs-identifier">thawIOArray</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeThawSTArray"><span class="hs-identifier hs-var">Arr.Array</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeThawSTArray"><span class="hs-identifier hs-var">ix</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeThawSTArray"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeThawSTArray"><span class="hs-identifier hs-var">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1535"></a><span class="hs-identifier">thawIOArray</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.IOArray.html#IOArray"><span class="hs-identifier hs-var">arr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stToIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1536"></a><span>    </span><span class="hs-identifier">marr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ArrST.thawSTArray</span><span> </span><span class="hs-identifier">arr</span><span>
</span><a name="line-1537"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><span>
</span><a name="line-1539"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1540"></a><span class="hs-pragma">&quot;thaw/IOArray&quot;</span><span>  </span><span class="hs-pragma">thaw</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">thawIOArray</span><span>
</span><a name="line-1541"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1542"></a><span>
</span><a name="line-1543"></a><span class="hs-identifier">freezeIOArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Arr.Array</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1544"></a><span class="hs-identifier">freezeIOArray</span><span> </span><span class="hs-special">(</span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#thawSTArray"><span class="hs-identifier hs-var">IOArray</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#thawSTArray"><span class="hs-identifier hs-var">marr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">stToIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ArrST.freezeSTArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>
</span><a name="line-1546"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1547"></a><span class="hs-pragma">&quot;freeze/IOArray&quot;</span><span>  </span><span class="hs-pragma">freeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">freezeIOArray</span><span>
</span><a name="line-1548"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1549"></a><span>
</span><a name="line-1550"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unsafeFreezeIOArray</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1551"></a><span class="hs-identifier">unsafeFreezeIOArray</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Arr.Array</span><span> </span><span class="hs-identifier">ix</span><span> </span><span class="hs-identifier">e</span><span class="hs-special">)</span><span>
</span><a name="line-1552"></a><span class="hs-identifier">unsafeFreezeIOArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IOArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#Array"><span class="hs-identifier hs-type">stToIO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ArrST.unsafeFreezeSTArray</span><span> </span><span class="hs-identifier">marr</span><span class="hs-special">)</span><span>
</span><a name="line-1553"></a><span>
</span><a name="line-1554"></a><span class="hs-pragma">{-# RULES</span><span>
</span><a name="line-1555"></a><span class="hs-pragma">&quot;unsafeFreeze/IOArray&quot;</span><span>  </span><span class="hs-pragma">unsafeFreeze</span><span> </span><span class="hs-pragma">=</span><span> </span><span class="hs-pragma">unsafeFreezeIOArray</span><span>
</span><a name="line-1556"></a><span>    </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1557"></a><span>
</span><a name="line-1558"></a><span class="hs-comment">-- | Casts an 'STUArray' with one element type into one with a</span><span>
</span><a name="line-1559"></a><span class="hs-comment">-- different element type.  All the elements of the resulting array</span><span>
</span><a name="line-1560"></a><span class="hs-comment">-- are undefined (unless you know what you\'re doing...).</span><span>
</span><a name="line-1561"></a><span>
</span><a name="line-1562"></a><a name="unsafeFreezeIOArray"><a href="Data.Array.Base.html#unsafeFreezeIOArray"><span class="hs-identifier">castSTUArray</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">STUArray</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.IOArray.html#IOArray"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-identifier">ix</span><span> </span><a name="local-6989586621679031573"><a href="#local-6989586621679031573"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ST</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.IO.html#stToIO"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeFreezeSTArray"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeFreezeSTArray"><span class="hs-identifier hs-var">ix</span></a><span> </span><a href="../base/src/%{MODULE}.html#%{NAME}/GHC.Arr.html#unsafeFreezeSTArray"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span class="hs-identifier">castSTUArray</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">STUArray</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">marr#</span><span class="hs-special">)</span><span>
</span><a name="line-1564"></a></pre></body></html>